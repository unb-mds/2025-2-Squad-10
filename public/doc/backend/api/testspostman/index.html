<!DOCTYPE html>
<html lang="pt-br">
<head><script src="/2025-2-OncoMap/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=2025-2-OncoMap/livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>
        
            Testspostman | OncoMap
        
    </title>
    

    
    
    
    
    
    
    
    
    
    
    

    
        
        
    
    
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="http://localhost:1313/2025-2-OncoMap/css/doc-page-bundle.min.css">



</head>
<body>

    <nav class="navbar">

    <a class="navbar-brand" href="http://localhost:1313/2025-2-OncoMap/">
        OncoMap
    </a>

    <ul class="navbar-links">
        <li><a href="http://localhost:1313/2025-2-OncoMap/">In√≠cio</a></li>
        <li><a href="http://localhost:1313/2025-2-OncoMap/sprints/">Sprints</a></li>
        <li><a href="http://localhost:1313/2025-2-OncoMap/requisitos/">Requisitos</a></li>
        <li><a href="http://localhost:1313/2025-2-OncoMap/arquitetura/">Arquitetura</a></li>
        <li><a href="http://localhost:1313/2025-2-OncoMap/diversos/">Diversos</a></li>
        <li><a href="http://localhost:1313/2025-2-OncoMap/doc/">Documenta√ß√£o</a></li>
    </ul>

    <div class="navbar-right">
        <a href="https://github.com/unb-mds/2025-2-OncoMap" target="_blank">GitHub</a>
    </div>

</nav>

    <section class="hero">
    <div class="container">
        <h1>Testspostman</h1>
        
        
        
        </div>
</section>

    <main>
        

    <div class="container page-single">
        
        
        
        
        <div class="content">
            <h1 id="an√°lise-de-arquitetura-de-dados-para-o-projeto-oncomap">An√°lise de Arquitetura de Dados para o Projeto OncoMap</h1>
<h3 id="issue-defini√ß√£o-da-estrat√©gia-de-tratamento-de-dados">Issue: Defini√ß√£o da estrat√©gia de tratamento de dados</h3>
<hr>
<h2 id="-descri√ß√£o--objetivo">üìñ Descri√ß√£o / Objetivo</h2>
<p>Este documento detalha a pesquisa e os testes realizados para determinar a arquitetura de tratamento de dados mais eficiente para o projeto OncoMap. O objetivo principal √© garantir que a plataforma interativa tenha um tempo de resposta r√°pido para o usu√°rio final, mesmo ao consultar grandes volumes de dados, como os de uma regi√£o inteira do Brasil.</p>
<p>Foram analisadas duas abordagens principais:</p>
<ol>
<li><strong>Sem Banco de Dados Pr√≥prio:</strong> O backend atua como um intermedi√°rio (proxy), consultando a API do Querido Di√°rio em tempo real a cada requisi√ß√£o do usu√°rio.</li>
<li><strong>Com Banco de Dados Pr√≥prio:</strong> O backend utiliza um processo de coleta ass√≠ncrono para popular um banco de dados local (PostgreSQL), e a API do projeto consulta essa base de dados otimizada para responder rapidamente √†s requisi√ß√µes do usu√°rio.</li>
</ol>
<hr>
<h2 id="-testes-realizados-e-descobertas">‚úÖ Testes Realizados e Descobertas</h2>
<p>Para validar o comportamento da API do Querido Di√°rio e entender suas capacidades, foi realizado um teste de consulta utilizando o Postman.</p>
<h3 id="teste-1-consulta-a-um-√∫nico-munic√≠pio-rio-de-janeiro">Teste 1: Consulta a um √önico Munic√≠pio (Rio de Janeiro)</h3>
<p>Foi feita uma requisi√ß√£o <code>GET</code> para a API buscando por m√∫ltiplos termos (<code>quimioterapia,radioterapia,oncologia</code>) no munic√≠pio do Rio de Janeiro (<code>territory_id: 3304557</code>) durante o ano de 2024.</p>
<p><strong>Par√¢metros da Requisi√ß√£o:</strong></p>
<p><img src="https://i.imgur.com/K5f4p6O.png" alt="Par√¢metros da Requisi√ß√£o no Postman"></p>
<p><strong>Resultado da Requisi√ß√£o:</strong></p>
<p>A API retornou com sucesso (<code>Status 200 OK</code>) um total de <strong>83 di√°rios oficiais</strong> que continham pelo menos um dos termos pesquisados.</p>
<p><strong>Trecho da Resposta JSON:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;total_gazettes&#34;</span>: <span style="color:#ae81ff">83</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;gazettes&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;territory_id&#34;</span>: <span style="color:#e6db74">&#34;3304557&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#e6db74">&#34;2024-01-11&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;territory_name&#34;</span>: <span style="color:#e6db74">&#34;Rio de Janeiro&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;excerpts&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;LTDA 181 R$ 110.413,86\n\n182 CI0519/05/2023 1614312\nCENTRAL DISTRIBUIDORA ADMINISTRACAO E \n\n...&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;DO RIO DE JANEIRO SA / RTONCO RJ\n183 R$ 16.261,26\n\n184 CI0219/05/2023 5990297 CENTRO DE EXCELENCIA ONCOLOGICA S A 184 R$ 225.908,03...&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;territory_id&#34;</span>: <span style="color:#e6db74">&#34;3304557&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#e6db74">&#34;2024-10-15&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;territory_name&#34;</span>: <span style="color:#e6db74">&#34;Rio de Janeiro&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;excerpts&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;...370 CI0407/08/2024 428515 COI CLINICAS ONCOLOGICAS INTEGRADAS SA 39.086.160/0001-30 Habilitado R$ 1.928.211,47 R$ 220.940,71\n\n...&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="principais-descobertas-do-teste">Principais Descobertas do Teste</h3>
<ol>
<li><strong>Qualidade dos Dados:</strong> O texto no campo <code>excerpts</code> √© bruto e n√£o estruturado, exigindo um processamento significativo (parsing) para extrair informa√ß√µes √∫teis como nomes de empresas e, principalmente, valores financeiros.</li>
<li><strong>Flexibilidade da <code>querystring</code>:</strong> O par√¢metro <code>querystring</code> aceita m√∫ltiplos termos separados por v√≠rgula, o que aumenta a abrang√™ncia da busca e o n√∫mero de resultados relevantes.</li>
<li><strong>Limita√ß√£o Cr√≠tica da API:</strong> Em testes subsequentes, foi validado que a API do Querido Di√°rio <strong>n√£o permite a consulta de m√∫ltiplos <code>territory_ids</code> em uma √∫nica requisi√ß√£o.</strong> Cada munic√≠pio deve ser consultado individualmente.</li>
</ol>
<hr>
<h2 id="-o-problema-e-a-solu√ß√£o">üìå O Problema e a Solu√ß√£o</h2>
<h3 id="o-problema-a-inviabilidade-da-abordagem-em-tempo-real">O Problema: A Inviabilidade da Abordagem em Tempo Real</h3>
<p>O design do OncoMap exige a visualiza√ß√£o de dados agregados por regi√£o (ex: &ldquo;Regi√£o Sudeste&rdquo;). A Regi√£o Sudeste possui <strong>1.668 munic√≠pios</strong>.</p>
<p>Considerando a <strong>Limita√ß√£o Cr√≠tica</strong> descoberta (s√≥ √© poss√≠vel consultar um munic√≠pio por vez), a abordagem <strong>sem banco de dados</strong> exigiria que o nosso backend fizesse <strong>1.668 chamadas sequenciais ou paralelas</strong> √† API do Querido Di√°rio <strong>toda vez que um usu√°rio clicasse na Regi√£o Sudeste</strong>.</p>
<p><strong>An√°lise de Tempo de Resposta (Estimativa):</strong></p>
<ul>
<li>Tempo m√©dio de uma requisi√ß√£o √† API externa: ~1.5 segundos.</li>
<li>Tempo total para consultar a Regi√£o Sudeste: <code>1668 munic√≠pios * 1.5s/munic√≠pio = 2502 segundos</code>.</li>
<li><strong>Resultado: Aproximadamente 41 minutos de espera para o usu√°rio.</strong></li>
</ul>
<blockquote>
<p>Esta an√°lise comprova que a abordagem em tempo real √© tecnicamente invi√°vel e resultaria em uma experi√™ncia de usu√°rio inaceit√°vel.</p></blockquote>
<h3 id="a-solu√ß√£o-arquitetura-com-banco-de-dados-pr√≥prio">A Solu√ß√£o: Arquitetura com Banco de Dados Pr√≥prio</h3>
<p>A solu√ß√£o definitiva √© a ado√ß√£o de uma arquitetura que desacopla a coleta de dados da exibi√ß√£o.</p>
<p><strong>Diagrama da Arquitetura:</strong></p>
<pre tabindex="0"><code>[Frontend (Mapa)] &lt;--&gt; [Nossa API (R√°pida)] &lt;--&gt; [Nosso Banco de Dados (PostgreSQL)]

[Coletor (Lento, em background)] --(faz as 1.668+ chamadas)--&gt; [API Querido Di√°rio] --(salva os dados)--&gt; [Nosso Banco de Dados]
</code></pre><p><strong>Como Funciona:</strong></p>
<ol>
<li><strong>Fase de Coleta (Offline):</strong> Um script &ldquo;Coletor&rdquo; (<code>collector.js</code>) √© executado em segundo plano. Ele tem a paci√™ncia de fazer as milhares de chamadas necess√°rias √† API do Querido Di√°rio, processar os textos, extrair os valores, categorizar as informa√ß√µes e salvar tudo de forma limpa e estruturada no nosso banco de dados PostgreSQL.</li>
<li><strong>Fase de Exibi√ß√£o (Tempo Real):</strong> Quando o usu√°rio clica na &ldquo;Regi√£o Sudeste&rdquo;, nossa API executa uma <strong>√∫nica e otimizada consulta SQL</strong> ao <strong>nosso pr√≥prio banco de dados</strong>. Essa opera√ß√£o busca os dados j√° processados e agregados.</li>
</ol>
<p><strong>Comparativo de Performance:</strong></p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Abordagem</th>
          <th style="text-align: left">Tempo de Resposta (Consulta de Regi√£o)</th>
          <th style="text-align: left">Experi√™ncia do Usu√°rio</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>Sem Banco de Dados</strong></td>
          <td style="text-align: left"><strong>~41 minutos</strong></td>
          <td style="text-align: left">Inaceit√°vel / Quebrado</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Com Banco de Dados</strong></td>
          <td style="text-align: left"><strong>~100 - 500 milissegundos</strong></td>
          <td style="text-align: left">Instant√¢nea</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="-ideia-conclusiva">üí° Ideia Conclusiva</h2>
<p>A utiliza√ß√£o de um banco de dados pr√≥prio (PostgreSQL) n√£o √© apenas uma melhoria, mas um <strong>requisito fundamental</strong> para a viabilidade do projeto OncoMap. Ele permite transformar um processo de coleta de dados lento e complexo em uma experi√™ncia de usu√°rio r√°pida, fluida e rica em informa√ß√µes, al√©m de ser o alicerce para funcionalidades avan√ßadas como a gera√ß√£o de relat√≥rios com LLM.</p>
<hr>
<h2 id="-crit√©rios-de-aceita√ß√£o-de-performance">üìå Crit√©rios de Aceita√ß√£o de Performance</h2>
<p>Com a arquitetura de banco de dados definida, estabelecemos o seguinte crit√©rio de aceita√ß√£o para a performance da nossa API interna:</p>
<ul>
<li><strong>Toda e qualquer requisi√ß√£o do frontend para a nossa API de backend (<code>/api/...</code>) que busque dados para exibi√ß√£o no mapa (seja por munic√≠pio, estado ou regi√£o) deve ter um tempo de resposta inferior a <code>500ms</code>.</strong></li>
</ul>
<hr>
<h2 id="-links-√∫teis">üîó Links √öteis</h2>
<ul>
<li><a href="https://queridodiario.ok.org.br/api/docs">Documenta√ß√£o da API Querido Di√°rio</a></li>
<li><a href="https://github.com/okfn-brasil/querido-diario-api">GitHub do Querido Di√°rio</a></li>
</ul>
<!-- end list -->
<pre tabindex="0"><code></code></pre>
        </div>
    </div>


    </main>

    <footer class="footer">
    <div class="container">
        <div class="footer-grid">
            
            <div class="footer-column about">
                <h3>OncoMap</h3>
                <p>Mapa de investimento em sa√∫de oncol√≥gica</p>
            </div>
            
            <div class="footer-column links">
                <h3>Links √öteis</h3>
                <ul>
                    <li><a href="http://localhost:1313/2025-2-OncoMap/">In√≠cio</a></li>
                    <li><a href="http://localhost:1313/2025-2-OncoMap/sprints">Sprints</a></li>
                    
                    
                    
                    
                        <li><a href="http://localhost:1313/2025-2-OncoMap/requisitos/">Requisitos</a></li>
                    
                    
                    
                    
                        <li><a href="http://localhost:1313/2025-2-OncoMap/arquitetura/">Arquitetura</a></li>
                    
                </ul>
            </div>
            
            <div class="footer-column contact">
                <h3>Contato</h3>
                <ul>
                    <li><a href="https://github.com/unb-mds/2025-2-OncoMap" target="_blank">GitHub</a></li>
                </ul>
            </div>

        </div>
    </div>
    
    <div class="footer-bottom">
        <div class="container">
            <p>&copy; 2025 OncoMap. Todos os direitos reservados.</p>
            <p>Desenvolvido pela equipe UnB-MDS</p>
        </div>
    </div>
</footer>
    
    <script src="http://localhost:1313/2025-2-OncoMap/js/app.js"></script>
</body>
</html>